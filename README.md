# lms-ts-node

## 1. Outline

### 1.1. Introduction

ì•„ëž˜ì˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°•ì˜ ì‹œìŠ¤í…œ APIë¥¼ êµ¬í˜„í•´ì£¼ì„¸ìš”.
ëª¨ë“  í…Œì´ë¸”/í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ë³¸ì¸ì´ ì•„ëŠ” ì„ ì—ì„œ ê°€ìž¥ ì¢‹ì€ í˜•íƒœë¡œ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.
URLì„ ë¹„ë¡¯í•´ì„œ í…Œì´ë¸”ëª…, í´ëž˜ìŠ¤ëª…, íŒŒì¼ëª…, functionëª… ë“± ì•„ëž˜ ì„œìˆ ëœ ë‚´ìš©ì„ ì œì™¸í•œ ëª¨ë“  ë‚´ìš©ë“¤ì€ í•  ìˆ˜ ìžˆëŠ” ê°€ìž¥ ì¢‹ì€ ì»¨ë²¤ì…˜ì„ ë”°ë¼ ì§„í–‰í•©ë‹ˆë‹¤.
ì§ì ‘ ì„œë¹„ìŠ¤ í•œë‹¤ëŠ” ìƒê°ìœ¼ë¡œ ìµœëŒ€í•œ í˜‘ì—…í•˜ê¸° ì¢‹ê³ , ê²¬ê³ í•˜ê³ , êµ¬ì¡°í™”ë˜ê³ , í™•ìž¥ì— ì—´ë ¤ ìžˆëŠ” êµ¬ì¡°ë¡œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

### 1.2. Directories

```
ðŸ“¦src
â”£ ðŸ“‚common
â”ƒ â”£ ðŸ“‚error
â”ƒ â”ƒ â”£ ðŸ“‚http-error// HTTP ì‘ë‹µ ì—ëŸ¬ í´ëž˜ìŠ¤
â”ƒ â”£ ðŸ“‚pagination // íŽ˜ì´ì§• ê´€ë ¨ í´ëž˜ìŠ¤
â”ƒ â”— ðŸ“‚util // ìœ í‹¸ í´ëž˜ìŠ¤
â”£ ðŸ“‚lecture // ê°•ì˜ ì• ê·¸ë¦¬ê±°íŠ¸
â”ƒ â”£ ðŸ“‚application // ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ
â”ƒ â”ƒ â”£ ðŸ“‚adapter // ì™¸ë¶€ API ì¸í„°íŽ˜ì´ìŠ¤
â”ƒ â”£ ðŸ“‚domain // ë„ë©”ì¸ ê³„ì¸µ
â”ƒ â”ƒ â”£ ðŸ“‚repository // ë ˆí¬ì§€í† ë¦¬ ì¸í„°íŽ˜ì´ìŠ¤
â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚dto // ê²€ìƒ‰ ë° ì‘ë‹µ dto
â”ƒ â”£ ðŸ“‚infra // ì¸í”„ë¼ ê³„ì¸µ
â”ƒ â”ƒ â”£ ðŸ“‚adapter // ì™¸ë¶€ API êµ¬í˜„ì²´
â”ƒ â”ƒ â”— ðŸ“‚repository // ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì²´
â”ƒ â”£ ðŸ“‚interface // ì¸í„°íŽ˜ì´ìŠ¤ ê³„ì¸µ
â”ƒ â”£ ðŸ“‚routes // ë¼ìš°í„°
â”£ ðŸ“‚student // í•™ìƒ ì• ê·¸ë¦¬ê±°íŠ¸
â”£ ðŸ“‚instructor // ê°•ì‚¬ ì• ê·¸ë¦¬ê±°íŠ¸
â”£ ðŸ“‚middleware // ë¯¸ë“¤ì›¨ì–´
â”£ ðŸ“œapp.config.ts // ì•± ì˜ì¡´ì„± ì£¼ìž…
â”£ ðŸ“œapp.ts
â”£ ðŸ“œdb.ts
â”— ðŸ“œserver.ts
```

## 2. Installation

### 2.1. NodeJS

```
v18.10.0
```

### 2.2. MySQL

```
# PULL DOCKER MySQL IMAGE
docker pull mysql

# RUN DOCKER MySQL
docker run --name mysql-lms -e MYSQL_ROOT_PASSWORD=1234 -d -p 3306:3306 mysql:latest

# CREATE DATABASE
mysql> CREATE DATABASE lms
```

### 2.3. Repository

```
# CLONE REPOSITORY
git clone ${REPOSITORY}
cd lms-ts-node

# INSTALL DEPENDENCIES
npm install

# START DEVELOPMENT
npm run dev
```

### 2.4. Data

```
# Seed initial data
npm run setup

# Run test code
npm run test
```

## 3. Development

### 3.1. ERD

![Alt text](image.png)

### 3.2 ì„¤ê³„

**ë„ë©”ì¸ ì„¤ê³„**
```
ê°•ì‚¬, ê°•ì˜, ìˆ˜ê°•ìƒ ì„¸ê°€ì§€ì˜ ë„ë©”ì¸ì´ ìžˆìŠµë‹ˆë‹¤.
ê°•ì˜ì™€ ìˆ˜ê°•ìƒì˜ ê´€ê³„ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ì´ë¯€ë¡œ ì‚¬ì´ì— ì—°ê´€ ê´€ê³„ í…Œì´ë¸”ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì—°ê´€ ê´€ê³„ í…Œì´ë¸”ì€ ìˆ˜ê°•(enrollment)ìž…ë‹ˆë‹¤.
ìˆ˜ê°• í…Œì´ë¸”ì„ ê°•ì˜ ë„ë©”ì¸ì˜ í•˜ìœ„ ì—”í‹°í‹°ë¡œ ë¶„ë¥˜í•˜ì˜€ìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ìˆ˜ê°•ì— ê´€ë ¨ ëœ ê¸°ëŠ¥ì€ ë£¨íŠ¸ ì• ê·¸ë¦¬ê±°íŠ¸ì¸ ê°•ì˜ ë„ë©”ì¸ì—ì„œ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.
```

**ê³„ì¸µí˜• êµ¬ì¡°**
```
ë„ë©”ì¸, ì• í”Œë¦¬ì¼€ì´ì…˜, ì¸í„°íŽ˜ì´ìŠ¤, ì¸í”„ë¼ ê³„ì¸µì„ ê°€ì§‘ë‹ˆë‹¤.
ê³„ì¸µê°„ ì°¸ì¡°ëŠ” ìƒìœ„(ìš°ì¸¡)ì—ì„œ í•˜ìœ„(ì¢Œì¸¡)ë¡œ í–¥í•©ë‹ˆë‹¤.
ë ˆí¬ì§€í† ë¦¬ í˜¹ì€ ì™¸ë¶€ API ì‚¬ìš©ê³¼ ê°™ì€ ì¸í”„ë¼ ê³„ì¸µì˜ ê¸°ëŠ¥ì´ í•„ìš”ì‹œ
ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ í•˜ìœ„ ê³„ì¸µì— ë‘ê³ , ì¸í”„ë¼ ê³„ì¸µì— êµ¬í˜„ì²´ë¥¼ ë‘ì–´ í•˜ìœ„ ê³„ì¸µì€ ì¶”ìƒí™”ì—ë§Œ ì˜ì¡´í•©ë‹ˆë‹¤.
```

### 3.3 êµ¬í˜„ì‹œ ê³ ë ¤ì‚¬í•­

**ê°•ì˜ ëª©ë¡ ì¡°íšŒ**
```
ê°•ì˜ ëª©ë¡ ì¡°íšŒì‹œ ê°•ì‚¬, ìˆ˜ê°•, í•™ìƒ í…Œì´ë¸”ë„ í•¨ê»˜ ì¡°íšŒë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
ê°•ì‚¬ëŠ” ê°•ì˜ ìž…ìž¥ì—ì„œ ë‹¤ëŒ€ì¼ ê´€ê³„ì´ê¸° ë•Œë¬¸ì— JOINì„ ì‚¬ìš©í•´ë„ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.
ìˆ˜ê°•ì€ ê°•ì˜ ìž…ìž¥ì—ì„œ ì¼ëŒ€ë‹¤ ê´€ê³„ì´ê¸° ë•Œë¬¸ì— ë‹¨ìˆœížˆ JOINì„ ì‚¬ìš©í•˜ë©´ íŽ˜ì´ì§•ì— ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤.
ì´ì— ë”°ë¼ ê°•ì˜ë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬, ê°•ì˜ idë¥¼ ê°€ì§„ ìˆ˜ê°•ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¡œ ë¶„ë¦¬ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ í•™ìƒ idë¡œ ê²€ìƒ‰í•˜ëŠ” ì¡°ê±´ì´ ì¶”ê°€ì ìœ¼ë¡œ ì¡´ìž¬í•©ë‹ˆë‹¤.
ì´ì— ë”°ë¼ í•™ìƒ í…Œì´ë¸”ì€ JOINì€ í•˜ë˜, SELECTëŠ” í•˜ì§€ ì•Šê³  DISTINCT í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ íŽ˜ì´ì§•ì„ ìœ„í•´ ê°•ì˜ë¥¼ ë¨¼ì € ì¡°íšŒí•©ë‹ˆë‹¤.

ì„±ëŠ¥ì„ ìœ„í•´ ê°•ì˜ë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ ê²°ê³¼ ë‚˜ì˜¤ëŠ” ê°•ì˜ ë°°ì—´ ì•ˆì—ì„œ ê°•ì˜ í•˜ë‚˜ì”© idë¥¼ ê°€ì ¸ì™€ ë§¤í•‘í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹Œ
WHERE IN ì ˆì„ ì´ìš©í•´ ê°•ì˜ idì˜ ë°°ì—´ë¡œ ì¡°íšŒ í›„ ë§¤í•‘í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
ì´ê²°ê³¼ í•„ìš”í•œ ì¿¼ë¦¬ëŠ” ì´ê°¯ìˆ˜ë¥¼ ìœ„í•œ COUNT ì¿¼ë¦¬, ê°•ì˜ ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬, ìˆ˜ê°•(+í•™ìƒ) ì¡°íšŒ ì¿¼ë¦¬ ì´ 3ë²ˆìœ¼ë¡œ í•´ê²°ë˜ë©°,
N+1 ê³¼ ê°™ì€ ORMì—ì„œ ìžì£¼ ë‚˜íƒ€ë‚˜ëŠ” ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
```

**ê°•ì˜ ë“±ë¡, ìˆ˜ê°•ì‹ ì²­ ë“±ì—ì„œì˜ ë³‘ë ¬ì²˜ë¦¬**
```
ê°•ì˜ ë“±ë¡ê³¼ ìˆ˜ê°•ì‹ ì²­ì—ì„œ Nê°œì˜ ë°ì´í„°ë¥¼ í•œë²ˆì— ì €ìž¥í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìžˆìŠµë‹ˆë‹¤.
ì´ë•Œ ì¼ë¶€ì˜ ë°ì´í„°ì˜ ì˜¤ë¥˜ë¥¼ ëŒ€ë¹„í•´ íŠ¸ëžœìž­ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.
íŠ¸ëžœìž­ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¨ì¼ ì»¤ë„¥ì…˜ì— ëŒ€í•´ ì—ëŸ¬ ë°œìƒì‹œ ë¡¤ë°± ì‹œì¼œì£¼ëŠ” ê¸°ëŠ¥ìž…ë‹ˆë‹¤.

ë‹¨ì¼ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´, ì„±ëŠ¥ì„ ìœ„í•´ Promise.allê³¼ ê°™ì€ ë³‘ë ¬ì²˜ë¦¬ ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ êµ¬í˜„í•˜ì—¬ë„ ë³‘ë ¬ë¡œì„œì˜ ê¸°ëŠ¥ì„ í•˜ì§€ ëª»í•©ë‹ˆë‹¤.
ì´ ê²½ìš°, ë³‘ë ¬ì²˜ë¦¬ í•˜ê³ ìž í•˜ëŠ” ê°ê°ì˜ ìš”ì²­ì—ì„œ ì»¤ë„¥ì…˜ì„ ì§ì ‘ ë°›ì•„ì˜¨í›„, ë°›ì•„ì˜¨ ì»¤ë„¥ì…˜ì„ ë°°ì—´ì— ë‹´ì•„ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
Promise.all ì´ ì•„ë‹Œ Promise.allSettledì„ ì‚¬ìš©í•˜ì—¬, ëª¨ë“  í•¨ìˆ˜ê°€ ìˆ˜í–‰ëœ í›„ ìµœì¢… ìƒíƒœê°’ì„ í™•ì¸í•©ë‹ˆë‹¤.
ì´ ë•Œ, reject ëœ ê°’ì´ ìžˆìœ¼ë©´ ìœ„ì— ê´€ë¦¬í•˜ë˜ ì»¤ë„¥ì…˜ ë°°ì—´ì„ ì „ë¶€ ë¡¤ë°± ì‹œí‚µë‹ˆë‹¤.

ìœ„ì˜ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ì‹œ ê³ ë ¤ì‚¬í•­ì€ Nê°œì˜ ë°ì´í„°ë¥¼ í•œë²ˆì— ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ë©´, ì»¤ë„¥ì…˜ë„ Nê°œë¥¼ ëª¨ë‘ ì°¨ì§€í•˜ê²Œ ë˜ë¯€ë¡œ
í•´ë‹¹ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  ì»¤ë„¥ì…˜ì˜ ê°¯ìˆ˜ë¥¼ ì§€ì •í•´ ë‘ê³ , ê·¸ ê°¯ìˆ˜ë§Œí¼ ë°ì´í„°ë¥¼ chunk ë°°ì—´ë¡œ ë‚˜ëˆ  ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìµœì¢… êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
```

**í…ŒìŠ¤íŠ¸**
ë„ë©”ì¸ ê³„ì¸µ TDDë¡œ ê°œë°œ
ì´ì™¸ ê³„ì¸µ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë ¤ í–ˆìœ¼ë‚˜ ì»¤ë„¥ì…˜ ë¡¤ë°±ì˜ ë¬¸ì œë¡œ ê³ ë¯¼ì¤‘

```
  beforeAll(async () => {
    AppConfig.init();
    testConnectionPool = createConnection();
  });

  beforeEach(async () => {
    lectureRepository = await container.resolve("LectureRepository");
    instructorService = await container.resolve("InstructorService");
    studentService = await container.resolve("StudentService");
    lectureService = new LectureService(
      lectureRepository,
      instructorService,
      studentService
    );
    Promise.all(
      Array.from({ length: 30 }, async () => {
        const conn = await testConnectionPool.getConnection();
        connArr.push(conn);
        conn.release();
        conn.beginTransaction();
      })
    );
  });

  afterEach(async () => {
    Promise.all(
      connArr.map(async (conn) => {
        await conn.rollback();
        conn.release();
      })
    );
  });
```
